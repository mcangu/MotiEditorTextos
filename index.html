<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MotiProcesador de Textos</title>
    <!-- Materialize CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
      rel="stylesheet"
    />
    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <!-- Quill Editor CSS -->
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <style>
      body {
        display: flex;
        min-height: 100vh;
        flex-direction: column;
      }
      main {
        flex: 1 0 auto;
      }
      #editor-container {
        height: 300px;
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <!-- Navbar con menú hamburguesa -->
    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo">MotiEditor</a>
        <a href="#" data-target="mobile-menu" class="sidenav-trigger">
          <i class="material-icons">menu</i>
        </a>
        <ul class="right hide-on-med-and-down">
          <li><a href="#" id="open-docx">Abrir DOCX</a></li>
          <li><a href="#" id="save-pdf">Guardar como PDF</a></li>
        </ul>
      </div>
    </nav>

    <!-- Menú hamburguesa responsive -->
    <ul class="sidenav" id="mobile-menu">
      <li><a href="#" id="open-docx-mobile">Abrir DOCX</a></li>
      <li><a href="#" id="save-pdf-mobile">Guardar como PDF</a></li>
    </ul>

    <!-- Contenido principal -->
    <main class="container">
      <h4>Procesador de Textos</h4>
      <!-- Contenedor del editor -->
      <div id="toolbar-container">
        <span class="ql-formats">
          <button class="ql-bold"></button>
          <!-- Botón de negrita -->
          <button class="ql-italic"></button>
          <!-- Botón de cursiva -->
          <button class="ql-underline"></button>
          <!-- Botón de subrayado -->
        </span>
      </div>
      <div id="editor-container"></div>
      <div class="row">
        <div class="col s12">
          <a id="open-docx-button" class="btn">Abrir Archivo DOCX</a>
          <input type="file" id="docx-input" style="display: none" />
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="page-footer">
      <div class="container">
        <div class="row">
          <div class="col l6 s12">
            <h5 class="white-text">Procesador de Textos</h5>
            <p class="grey-text text-lighten-4">
              Una simple aplicación web para editar texto y exportar archivos.
            </p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Quill Editor JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- jsPDF para generar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Mammoth.js para abrir archivos DOCX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

    <script>
      // Inicialización del menú hamburguesa
      document.addEventListener("DOMContentLoaded", function () {
        var elems = document.querySelectorAll(".sidenav");
        var instances = M.Sidenav.init(elems);
      });

      // Inicialización del editor Quill con el toolbar visible
      var quill = new Quill("#editor-container", {
        theme: "snow",
        modules: {
          toolbar: "#toolbar-container", // Barra de herramientas personalizada
        },
      });

      // Función para abrir archivo DOCX
      function openDocxFile() {
        document.getElementById("docx-input").click();
      }

      // Abrir archivo DOCX desde el menú principal y el menú hamburguesa
      document
        .getElementById("open-docx")
        .addEventListener("click", openDocxFile);
      document
        .getElementById("open-docx-mobile")
        .addEventListener("click", openDocxFile);

      // Abrir archivo DOCX desde el botón principal
      document
        .getElementById("open-docx-button")
        .addEventListener("click", openDocxFile);

      // Leer el archivo DOCX y mostrar el texto en el editor
      document
        .getElementById("docx-input")
        .addEventListener("change", function (event) {
          var reader = new FileReader();
          reader.onload = function (event) {
            var arrayBuffer = reader.result;
            mammoth
              .extractRawText({ arrayBuffer: arrayBuffer })
              .then(function (result) {
                quill.setText(result.value);
              })
              .catch(function (err) {
                console.error("Error leyendo DOCX", err);
              });
          };
          reader.readAsArrayBuffer(event.target.files[0]);
        });

      // Guardar como PDF
      document
        .getElementById("save-pdf")
        .addEventListener("click", function () {
          var doc = new jspdf.jsPDF();
          doc.text(quill.getText(), 10, 10);
          doc.save("documento.pdf");
        });

      // Guardar como PDF desde el menú hamburguesa
      document
        .getElementById("save-pdf-mobile")
        .addEventListener("click", function () {
          var doc = new jspdf.jsPDF();
          doc.text(quill.getText(), 10, 10);
          doc.save("documento.pdf");
        });
    </script>
  </body>
</html>
